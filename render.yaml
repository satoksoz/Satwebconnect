# render.yaml
# SatWebConnect ESP32 Dashboard Service Configuration
# GitHub Repository ROOT'ta olacak

services:
  - type: web
    name: satwebconnect
    env: node
    region: frankfurt  # Frankfurt, Avrupa için en iyi
    
    # Build Settings
    buildCommand: |
      cd dashboard_server &&
      npm install &&
      echo "✅ Build completed"
    
    # Start Command
    startCommand: |
      cd dashboard_server &&
      node server.js
    
    # Health Check (Render otomatik kontrol eder)
    healthCheckPath: /health
    initialDelaySec: 30
    
    # Auto-Deploy Settings
    autoDeploy: true
    branch: main
    
    # Environment Variables
    envVars:
      - key: NODE_ENV
        value: production
      
      - key: API_KEY
        generateValue: true  # Render otomatik güvenli key oluşturur
      
      - key: PORT
        value: 10000  # Render otomatik PORT atar, ama biz yine de belirtelim
    
    # PERSISTENT DISK - SQLite Database için GEREKLİ
    disk:
      name: satwebconnect-data
      mountPath: /opt/render/project/src/dashboard_server
      sizeGB: 1
    
    # Resource Limits (Free Plan)
    plan: free
    numInstances: 1
    
    # Advanced Settings
    dockerfilePath: ""  # Custom Dockerfile yok
    rootDir: ""         # Root directory (boş bırak)
    
    # CORS Headers (ESP32 için)
    headers:
      - path: /*
        name: Access-Control-Allow-Origin
        value: "*"
      - path: /*
        name: Access-Control-Allow-Methods
        value: "GET, POST, PUT, DELETE, OPTIONS"
      - path: /*
        name: Access-Control-Allow-Headers
        value: "Content-Type, Authorization"

# Database backup plan (opsiyonel)
# databases:
#   - name: satwebconnect-db
#     databaseName: satwebconnect
#     plan: free
#     ipAllowList: []